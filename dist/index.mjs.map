{"version":3,"sources":["../src/satori.ts","../src/schema.ts"],"sourcesContent":["// satori.ts\r\n// UNIVERSAL VERSION: Works in Node.js AND Browser (React)\r\n\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\n// Only import ws in Node.js\r\nlet NodeWebSocket: any = null;\r\nif (typeof window === \"undefined\") {\r\n  NodeWebSocket = require(\"ws\");\r\n}\r\n\r\n/**\r\n * Detect correct WebSocket implementation\r\n */\r\nfunction createWebSocket(url: string): WebSocket {\r\n  if (typeof window !== \"undefined\") {\r\n    // Browser WebSocket\r\n    return new window.WebSocket(url);\r\n  }\r\n  // Node WebSocket (ws)\r\n  return new NodeWebSocket(url);\r\n}\r\n\r\n// --- Interfaces (same as yours, unchanged) ---\r\nexport interface FieldCondition { field: string; value: string; }\r\nexport interface SetPayload { key?: string; vertices?: string[]; data?: Record<string, any>; type?: string; expires?: boolean; expiration_time?: number; field_array?: FieldCondition[]; one?: boolean; }\r\nexport interface GetPayload { key?: string; encryption_key?: string; field_array?: FieldCondition[]; one?: boolean; }\r\nexport interface PutPayload { key?: string; replace_field: string; replace_value: string; encryption_key?: string; field_array?: FieldCondition[]; one?: boolean; type?: string; }\r\nexport interface DeletePayload { key?: string; field_array?: FieldCondition[]; one?: boolean; type?: string; }\r\nexport interface SetVertexPayload { key: string; vertex: string | string[]; relation?: string; encryption_key?: string; }\r\nexport interface GetVertexPayload { key: string; encryption_key?: string; relation?: string; }\r\nexport interface DeleteVertexPayload { key: string; vertex: string; encryption_key?: string; }\r\nexport interface DfsPayload { node: string; encryption_key?: string; relation?: string; }\r\nexport interface EncryptPayload { key: string; encryption_key: string; }\r\nexport interface DecryptPayload { key: string; encryption_key: string; }\r\nexport interface TypeOnlyPayload { type: string; }\r\nexport interface RefPayload { key: string; ref?: string; encryption_key?: string; }\r\nexport interface AskPayload{ question: string; backend?: string }\r\nexport interface QueryPayload{ query: string; backend?: string }\r\nexport interface PushPayload{ key?: string; array: string; value: any; encryption_key?: string; field_array?: FieldCondition[]; one?: boolean; }\r\nexport interface PopPayload{ key?: string; array: string; encryption_key?: string; field_array?: FieldCondition[]; one?: boolean; }\r\nexport interface SplicePayload{ key?: string; array: string; encryption_key?: string; field_array?: FieldCondition[]; one?: boolean; }\r\nexport interface RemovePayload{ key?: string; array: string; value: any; encryption_key?: string; field_array?: FieldCondition[]; one?: boolean; }\r\nexport interface ANNPayload { key: string; top_k?: number; }\r\nexport interface SetMiddlewarePayload{operation: string; middleware: string};\r\ninterface CommandPayload { command: string; [key: string]: any; }\r\n\r\n/**\r\n * Satori Universal WebSocket Client\r\n */\r\nexport class Satori {\r\n  private username: string;\r\n  private password: string;\r\n  private host: string;\r\n  private ws: WebSocket | null = null;\r\n  private pending = new Map<string, (value: any) => void>();\r\n  private subscriptions = new Map<string, (data: any) => void>();\r\n\r\n  constructor({ username, password, host }: { username: string; password: string; host: string }) {\r\n    this.username = username;\r\n    this.password = password;\r\n    this.host = host;\r\n  }\r\n\r\n  /**\r\n   * Connect to Satori WebSocket\r\n   */\r\n  async connect(): Promise<void> {\r\n    this.ws = createWebSocket(this.host);\r\n\r\n    this.ws.onmessage = (event: any) => {\r\n      const msg = JSON.parse(event.data);\r\n\r\n      if (msg.type === \"notification\" && msg.key && this.subscriptions.has(msg.key)) {\r\n        this.subscriptions.get(msg.key)!(msg.data);\r\n        return;\r\n      }\r\n\r\n      if (msg.id && this.pending.has(msg.id)) {\r\n        this.pending.get(msg.id)!(msg);\r\n        this.pending.delete(msg.id);\r\n      }\r\n    };\r\n\r\n    return new Promise((resolve, reject) => {\r\n      if (!this.ws) return reject();\r\n\r\n      this.ws.onopen = () => resolve();\r\n      this.ws.onerror = (err) => reject(err);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send a command\r\n   */\r\n  private send(commandPayload: CommandPayload): Promise<any> {\r\n    return new Promise((resolve) => {\r\n      const id = uuidv4();\r\n      const msg = {\r\n        username: this.username,\r\n        password: this.password,\r\n        id,\r\n        ...commandPayload\r\n      };\r\n\r\n      this.pending.set(id, resolve);\r\n      this.ws?.send(JSON.stringify(msg));\r\n    });\r\n  }\r\n\r\n  // ---- Operations (unchanged) ----\r\n\r\n  async set(payload: SetPayload) { return this.send({ command: \"SET\", ...payload }); }\r\n  async push(payload: PushPayload) { return this.send({ command: \"PUSH\", ...payload }); }\r\n  async pop(payload: PopPayload) { return this.send({ command: \"POP\", ...payload }); }\r\n  async splice(payload: SplicePayload) { return this.send({ command: \"SPLICE\", ...payload }); }\r\n  async remove(payload: RemovePayload) { return this.send({ command: \"REMOVE\", ...payload }); }\r\n  async get(payload: GetPayload) { return this.send({ command: \"GET\", ...payload }); }\r\n  async put(payload: PutPayload) { return this.send({ command: \"PUT\", ...payload }); }\r\n  async delete(payload: DeletePayload) { return this.send({ command: \"DELETE\", ...payload }); }\r\n  async setVertex(payload: SetVertexPayload) { return this.send({ command: \"SET_VERTEX\", ...payload }); }\r\n  async getVertex(payload: GetVertexPayload) { return this.send({ command: \"GET_VERTEX\", ...payload }); }\r\n  async deleteVertex(payload: DeleteVertexPayload) { return this.send({ command: \"DELETE_VERTEX\", ...payload }); }\r\n  async dfs(payload: DfsPayload) { return this.send({ command: \"DFS\", ...payload }); }\r\n  async encrypt(payload: EncryptPayload) { return this.send({ command: \"ENCRYPT\", ...payload }); }\r\n  async decrypt(payload: DecryptPayload) { return this.send({ command: \"DECRYPT\", ...payload }); }\r\n  async train() { return this.send({ command: \"TRAIN\", type: \"train\" }); }\r\n  async ann(payload: ANNPayload) { return this.send({ command: \"ANN\", ...payload }); }\r\n  async ask(payload: AskPayload) { return this.send({ command: \"ASK\", ...payload }); }\r\n  async query(payload: QueryPayload) { return this.send({ command: \"QUERY\", ...payload }); }\r\n  async memory_stats() { return this.send({ command: \"MEMORY_STATS\" }); }\r\n  async cpu_stats() { return this.send({ command: \"CPU_STATS\" }); }\r\n  async get_operations() { return this.send({ command: \"GET_OPERATIONS\" }); }\r\n  async get_insights() { return this.send({ command: \"INSIGHTS\" }); }\r\n  async set_middleware(payload: SetMiddlewarePayload) {return this.send({command: \"SET_MIDDLEWARE\", ...payload})}\r\n\r\n  /**\r\n   * Subscriptions\r\n   */\r\n  notify(key: string, callback: (data: any) => void) {\r\n    this.subscriptions.set(key, callback);\r\n    this.ws?.send(JSON.stringify({\r\n      command: \"NOTIFY\",\r\n      key,\r\n      id: uuidv4(),\r\n      username: this.username,\r\n      password: this.password\r\n    }));\r\n  }\r\n}\r\n","import {Satori}from \"./satori\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nexport default class Schema<T extends object> {\r\n\r\n  satori!: Satori;\r\n  schemaName!: string;\r\n  body!: T;\r\n  key!: string;\r\n\r\n  constructor(body: T, satori: Satori, schemaName: string, key?: string) {\r\n    this.body = body;\r\n    this.satori = satori;\r\n\r\n    if (key) {\r\n      this.key = key;\r\n    }\r\n    this.key = uuidv4();\r\n    this.schemaName = schemaName;\r\n  }\r\n\r\n  async set(): Promise<string | boolean> {\r\n    return await this.satori.set({\r\n      key: this.key,\r\n      data: this.body,\r\n      type: this.schemaName,\r\n    });\r\n  }\r\n\r\n  async delete(): Promise<boolean> {\r\n    return await this.satori.delete({ key: this.key });\r\n  }\r\n\r\n  async encrypt(encryption_key: string): Promise<boolean> {\r\n    return await this.satori.encrypt({\r\n      key: this.key,\r\n      encryption_key: encryption_key,\r\n    });\r\n  }\r\n\r\n  async setVertex(vertex: string, relation: string, encryption_key?: string): Promise<boolean> {\r\n    return await this.satori.setVertex({\r\n      key: this.key,\r\n      vertex: vertex,\r\n      relation: relation,\r\n      encryption_key: encryption_key,\r\n    });\r\n  } //relation\r\n\r\n  async getVertex(encryption_key?: string): Promise<any | undefined> {\r\n    return await this.satori.getVertex({ key: this.key, encryption_key });\r\n  }\r\n\r\n  async deleteVertex(\r\n    vertex: string,\r\n    encryption_key?: string\r\n  ): Promise<Boolean> {\r\n    return this.satori.deleteVertex({\r\n      key: this.key,\r\n      encryption_key: encryption_key,\r\n      vertex: vertex,\r\n    });\r\n  }\r\n\r\n  async dfs(relation?: string, encryption_key?: string): Promise<any | undefined> {\r\n    return this.satori.dfs({ node: this.key, relation: relation, encryption_key });\r\n  }\r\n\r\n \r\n\r\n \r\n \r\n\r\n  async push(value: any, array: string, encryption_key?: string): Promise<Boolean> {\r\n    return await this.satori.push({key: this.key, value: value, array: array, encryption_key})\r\n  }\r\n\r\n  async pop(array: string, encryption_key?: string): Promise<Boolean> {\r\n    return await this.satori.pop({key: this.key, array: array, encryption_key})\r\n  }\r\n\r\n  async splice(array: string, encryption_key?: string): Promise<Boolean> {\r\n    return await this.satori.splice({key: this.key, array: array, encryption_key})\r\n  }\r\n\r\n  async remove(value: any, array: string, encryption_key?: string): Promise<Boolean> {\r\n    return await this.satori.remove({key: this.key, value: value, array: array, encryption_key})\r\n  }\r\n\r\n  async decrypt(encryption_key: string): Promise<Boolean> {\r\n    return await this.satori.decrypt({key: this.key, encryption_key: encryption_key})\r\n  }\r\n\r\n}\r\n"],"mappings":"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","names":["uuidv4"]}